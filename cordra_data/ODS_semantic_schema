{
  "identifier": "test.20.5000.1025/ODS_semantic_schema",
  "name": "ODS_semantic_schema",
  "description": "The json schema checks the that a correct jsonld object is passed. The semantic validation will afterwards be performed with the JavaScript library",
  "schema": {
    "definitions": {
      "previewInResultsTrue": {
        "cordra": {
          "preview": {
            "showInPreview": true
          }
        }
      },
      "previewInResultsFalse": {
        "cordra": {
          "preview": {
            "showInPreview": false
          }
        }
      }
    },
    "$schema": "http://json-schema.org/draft-04/schema",
    "type": "object",
    "title": "root openDS schema for ODStype1804",
    "description": "The root schema comprises the entire JSON document.",
    "required": [
      "id",
      "typeName",
      "@context",
      "@graph"
    ],
    "examples": [
      {
        "id": "20.5000.1025/ae88bb3a666ec72dbc52",
        "typeName": "ODStype1804",
        "@context": {
          "ods": "http://github.com/DiSSCo/openDS/ods-ontology/terms/"
        },
        "@graph": [
          {
            "@id": "https://doi.org/20.5000.1025/ae88bb3a666ec72dbc52",
            "ods:authoritative": {
              "ods:modified": "2021-06-17T09:18:02.130Z",
              "ods:midsLevel": 1,
              "ods:physicalSpecimenId": "NHMUK010517563",
              "ods:institution": [
                "NHMUK",
                "https://ror.org/039zvsn29"
              ],
              "ods:materialType": "Dry - pinned",
              "ods:name": "Elophila nymphaeata (Linnaeus, 1758)"
            }
          }
        ]
      }
    ],
    "properties": {
      "id": {
        "type": "string",
        "cordra": {
          "type": {
            "autoGeneratedField": "handle",
            "prependHandleMintingConfigPrefix": true
          },
          "preview": {
            "showInPreview": true
          }
        }
      },
      "typeName": {
        "$id": "#/properties/typeName",
        "type": "string",
        "title": "Type name",
        "enum": [
          "ODStype1804"
        ]
      },
      "@context": {
        "$id": "#/properties/%40context",
        "type": "object",
        "title": "RDF @context",
        "required": [
          "ods"
        ],
        "properties": {
          "ods": {
            "$id": "#/properties/%40context/properties/ods",
            "type": "string",
            "title": "The ods schema",
            "enum": [
              "http://github.com/DiSSCo/openDS/ods-ontology/terms/"
            ]
          }
        },
        "additionalProperties": true
      },
      "@graph": {
        "$id": "#/properties/%40graph",
        "type": "array",
        "title": "RDF @graph",
        "additionalItems": true
      }
    },
    "additionalProperties": false
  },
  "javascript": "var cordra = require(\"cordra\");\nvar odslib = require(\"ods-shex-validator\");\nvar jsonld = require(\"jsonld\");\n\nexports.beforeSchemaValidation = beforeSchemaValidation;\n\nfunction beforeSchemaValidation(object, context) {\n    console.log(\"beforeSchemaValidation: Validating RDF with Shex\");\n    console.log(\"object\", object);\n    console.log(\"object\", object.content[\"@context\"].ods);\n\n    let isValid;\n    odslib.validate(\n       \"http://172.28.128.8/objects/test.20.5000.1025/a45573cbd021fe072398?payload=payload\",\n       object.content,\n       \"https://doi.org/20.5000.1025/ae88bb3a666ec72dbc52\",\n       jsonld)\n    .then(function(r){\n       console.log(\"RDF validation is conformant:\", r[0].status);\n       isValid = r[0].status === \"conformant\";  \n    });\n\n    if(isValid){\n          return object;\n      } else {\n          console.log(\"will throw error RDF validation failed\");\n          throw(\"RDF validation failed\");\n      }\n}\n\n"
}
